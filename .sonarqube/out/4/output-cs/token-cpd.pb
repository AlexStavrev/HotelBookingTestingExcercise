∫]
u/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Controllers/BookingsController.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Controllers &
{		 
public

 

class

 
BookingsController

 #
:

$ %

Controller

& 0
{ 
private 
IRepository 
< 
Booking #
># $
bookingRepository% 6
;6 7
private 
IRepository 
< 
Customer $
>$ %
customerRepository& 8
;8 9
private 
IRepository 
< 
Room  
>  !
roomRepository" 0
;0 1
private 
IBookingManager 
bookingManager  .
;. /
private 
IBookingViewModel !
bookingViewModel" 2
;2 3
public 
BookingsController !
(! "
IRepository" -
<- .
Booking. 5
>5 6
bookingRepos7 C
,C D
IRepositoryE P
<P Q
RoomQ U
>U V
	roomReposW `
,` a
IRepository 
< 
Customer  
>  !
customerRepos" /
,/ 0
IBookingManager1 @
managerA H
,H I
IBookingViewModelJ [
	viewModel\ e
)e f
{ 	
bookingRepository 
= 
bookingRepos  ,
;, -
roomRepository 
= 
	roomRepos &
;& '
customerRepository 
=  
customerRepos! .
;. /
bookingManager 
= 
manager $
;$ %
bookingViewModel 
= 
	viewModel (
;( )
} 	
public 
IActionResult 
Index "
(" #
int# &
?& '
id( *
)* +
{ 	
bookingViewModel 
. 
YearToDisplay *
=+ ,
(- .
id. 0
==1 3
null4 8
)8 9
?: ;
DateTime< D
.D E
TodayE J
.J K
YearK O
:P Q
idR T
.T U
ValueU Z
;Z [
return   
View   
(   
bookingViewModel   (
)  ( )
;  ) *
}!! 	
public$$ 
IActionResult$$ 
Details$$ $
($$$ %
int$$% (
?$$( )
id$$* ,
)$$, -
{%% 	
if&& 
(&& 
id&& 
==&& 
null&& 
)&& 
{'' 
return(( 
NotFound(( 
(((  
)((  !
;((! "
})) 
Booking++ 
booking++ 
=++ 
bookingRepository++ /
.++/ 0
Get++0 3
(++3 4
id++4 6
.++6 7
Value++7 <
)++< =
;++= >
if,, 
(,, 
booking,, 
==,, 
null,, 
),,  
{-- 
return.. 
NotFound.. 
(..  
)..  !
;..! "
}// 
return11 
View11 
(11 
booking11 
)11  
;11  !
}22 	
public55 
IActionResult55 
Create55 #
(55# $
)55$ %
{66 	
ViewData77 
[77 
$str77 !
]77! "
=77# $
new77% (

SelectList77) 3
(773 4
customerRepository774 F
.77F G
GetAll77G M
(77M N
)77N O
,77O P
$str77Q U
,77U V
$str77W ]
)77] ^
;77^ _
return88 
View88 
(88 
)88 
;88 
}99 	
[>> 	
HttpPost>>	 
]>> 
[?? 	$
ValidateAntiForgeryToken??	 !
]??! "
public@@ 
IActionResult@@ 
Create@@ #
(@@# $
[@@$ %
Bind@@% )
(@@) *
$str@@* H
)@@H I
]@@I J
Booking@@K R
booking@@S Z
)@@Z [
{AA 	
ifBB 
(BB 

ModelStateBB 
.BB 
IsValidBB "
)BB" #
{CC 
boolDD 
createdDD 
=DD 
bookingManagerDD -
.DD- .
CreateBookingDD. ;
(DD; <
bookingDD< C
)DDC D
;DDD E
ifFF 
(FF 
createdFF 
)FF 
{GG 
returnHH 
RedirectToActionHH +
(HH+ ,
nameofHH, 2
(HH2 3
IndexHH3 8
)HH8 9
)HH9 :
;HH: ;
}II 
}JJ 
ViewDataLL 
[LL 
$strLL !
]LL! "
=LL# $
newLL% (

SelectListLL) 3
(LL3 4
customerRepositoryLL4 F
.LLF G
GetAllLLG M
(LLM N
)LLN O
,LLO P
$strLLQ U
,LLU V
$strLLW ]
,LL] ^
bookingLL_ f
.LLf g

CustomerIdLLg q
)LLq r
;LLr s
ViewBagMM 
.MM 
StatusMM 
=MM 
$strMM ^
;MM^ _
returnNN 
ViewNN 
(NN 
bookingNN 
)NN  
;NN  !
}OO 	
publicRR 
IActionResultRR 
EditRR !
(RR! "
intRR" %
?RR% &
idRR' )
)RR) *
{SS 	
ifTT 
(TT 
idTT 
==TT 
nullTT 
)TT 
{UU 
returnVV 
NotFoundVV 
(VV  
)VV  !
;VV! "
}WW 
BookingYY 
bookingYY 
=YY 
bookingRepositoryYY /
.YY/ 0
GetYY0 3
(YY3 4
idYY4 6
.YY6 7
ValueYY7 <
)YY< =
;YY= >
ifZZ 
(ZZ 
bookingZZ 
==ZZ 
nullZZ 
)ZZ  
{[[ 
return\\ 
NotFound\\ 
(\\  
)\\  !
;\\! "
}]] 
ViewData^^ 
[^^ 
$str^^ !
]^^! "
=^^# $
new^^% (

SelectList^^) 3
(^^3 4
customerRepository^^4 F
.^^F G
GetAll^^G M
(^^M N
)^^N O
,^^O P
$str^^Q U
,^^U V
$str^^W ]
,^^] ^
booking^^_ f
.^^f g

CustomerId^^g q
)^^q r
;^^r s
ViewData__ 
[__ 
$str__ 
]__ 
=__  
new__! $

SelectList__% /
(__/ 0
roomRepository__0 >
.__> ?
GetAll__? E
(__E F
)__F G
,__G H
$str__I M
,__M N
$str__O \
,__\ ]
booking__^ e
.__e f
RoomId__f l
)__l m
;__m n
return`` 
View`` 
(`` 
booking`` 
)``  
;``  !
}aa 	
[ff 	
HttpPostff	 
]ff 
[gg 	$
ValidateAntiForgeryTokengg	 !
]gg! "
publichh 
IActionResulthh 
Edithh !
(hh! "
inthh" %
idhh& (
,hh( )
[hh* +
Bindhh+ /
(hh/ 0
$strhh0 ^
)hh^ _
]hh_ `
Bookinghha h
bookinghhi p
)hhp q
{ii 	
ifjj 
(jj 
idjj 
!=jj 
bookingjj 
.jj 
Idjj  
)jj  !
{kk 
returnll 
NotFoundll 
(ll  
)ll  !
;ll! "
}mm 
ifoo 
(oo 

ModelStateoo 
.oo 
IsValidoo "
)oo" #
{pp 
tryqq 
{rr 
bookingRepositoryss %
.ss% &
Editss& *
(ss* +
bookingss+ 2
)ss2 3
;ss3 4
}tt 
catchuu 
(uu (
DbUpdateConcurrencyExceptionuu 3
)uu3 4
{vv 
ifww 
(ww 
bookingRepositoryww )
.ww) *
Getww* -
(ww- .
bookingww. 5
.ww5 6
Idww6 8
)ww8 9
==ww: <
nullww= A
)wwA B
{xx 
returnyy 
NotFoundyy '
(yy' (
)yy( )
;yy) *
}zz 
else{{ 
{|| 
throw}} 
;}} 
}~~ 
} 
return
ÄÄ 
RedirectToAction
ÄÄ '
(
ÄÄ' (
nameof
ÄÄ( .
(
ÄÄ. /
Index
ÄÄ/ 4
)
ÄÄ4 5
)
ÄÄ5 6
;
ÄÄ6 7
}
ÅÅ 
ViewData
ÇÇ 
[
ÇÇ 
$str
ÇÇ !
]
ÇÇ! "
=
ÇÇ# $
new
ÇÇ% (

SelectList
ÇÇ) 3
(
ÇÇ3 4 
customerRepository
ÇÇ4 F
.
ÇÇF G
GetAll
ÇÇG M
(
ÇÇM N
)
ÇÇN O
,
ÇÇO P
$str
ÇÇQ U
,
ÇÇU V
$str
ÇÇW ]
,
ÇÇ] ^
booking
ÇÇ_ f
.
ÇÇf g

CustomerId
ÇÇg q
)
ÇÇq r
;
ÇÇr s
ViewData
ÉÉ 
[
ÉÉ 
$str
ÉÉ 
]
ÉÉ 
=
ÉÉ  
new
ÉÉ! $

SelectList
ÉÉ% /
(
ÉÉ/ 0
roomRepository
ÉÉ0 >
.
ÉÉ> ?
GetAll
ÉÉ? E
(
ÉÉE F
)
ÉÉF G
,
ÉÉG H
$str
ÉÉI M
,
ÉÉM N
$str
ÉÉO \
,
ÉÉ\ ]
booking
ÉÉ^ e
.
ÉÉe f
RoomId
ÉÉf l
)
ÉÉl m
;
ÉÉm n
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 
booking
ÑÑ 
)
ÑÑ  
;
ÑÑ  !
}
ÖÖ 	
public
àà 
IActionResult
àà 
Delete
àà #
(
àà# $
int
àà$ '
?
àà' (
id
àà) +
)
àà+ ,
{
ââ 	
if
ää 
(
ää 
id
ää 
==
ää 
null
ää 
)
ää 
{
ãã 
return
åå 
NotFound
åå 
(
åå  
)
åå  !
;
åå! "
}
çç 
Booking
èè 
booking
èè 
=
èè 
bookingRepository
èè /
.
èè/ 0
Get
èè0 3
(
èè3 4
id
èè4 6
.
èè6 7
Value
èè7 <
)
èè< =
;
èè= >
if
êê 
(
êê 
booking
êê 
==
êê 
null
êê 
)
êê  
{
ëë 
return
íí 
NotFound
íí 
(
íí  
)
íí  !
;
íí! "
}
ìì 
return
ïï 
View
ïï 
(
ïï 
booking
ïï 
)
ïï  
;
ïï  !
}
ññ 	
[
ôô 	
HttpPost
ôô	 
,
ôô 

ActionName
ôô 
(
ôô 
$str
ôô &
)
ôô& '
]
ôô' (
[
öö 	&
ValidateAntiForgeryToken
öö	 !
]
öö! "
public
õõ 
IActionResult
õõ 
DeleteConfirmed
õõ ,
(
õõ, -
int
õõ- 0
id
õõ1 3
)
õõ3 4
{
úú 	
bookingRepository
ùù 
.
ùù 
Remove
ùù $
(
ùù$ %
id
ùù% '
)
ùù' (
;
ùù( )
return
ûû 
RedirectToAction
ûû #
(
ûû# $
nameof
ûû$ *
(
ûû* +
Index
ûû+ 0
)
ûû0 1
)
ûû1 2
;
ûû2 3
}
üü 	
}
°° 
}¢¢ ∫;
v/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Controllers/CustomersController.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Controllers &
{ 
public 

class 
CustomersController $
:% &

Controller' 1
{		 
private

 
IRepository

 
<

 
Customer

 $
>

$ %

repository

& 0
;

0 1
public 
CustomersController "
(" #
IRepository# .
<. /
Customer/ 7
>7 8
repos9 >
)> ?
{ 	

repository 
= 
repos 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 

repository "
." #
GetAll# )
() *
)* +
.+ ,
ToList, 2
(2 3
)3 4
)4 5
;5 6
} 	
public 
IActionResult 
Details $
($ %
int% (
?( )
id* ,
), -
{ 	
if 
( 
id 
== 
null 
) 
{ 
return 
NotFound 
(  
)  !
;! "
} 
Customer 
customer 
= 

repository  *
.* +
Get+ .
(. /
id/ 1
.1 2
Value2 7
)7 8
;8 9
if   
(   
customer   
==   
null    
)    !
{!! 
return"" 
NotFound"" 
(""  
)""  !
;""! "
}## 
return%% 
View%% 
(%% 
customer%%  
)%%  !
;%%! "
}&& 	
public)) 
IActionResult)) 
Create)) #
())# $
)))$ %
{** 	
return++ 
View++ 
(++ 
)++ 
;++ 
},, 	
[11 	
HttpPost11	 
]11 
[22 	$
ValidateAntiForgeryToken22	 !
]22! "
public33 
IActionResult33 
Create33 #
(33# $
[33$ %
Bind33% )
(33) *
$str33* 9
)339 :
]33: ;
Customer33< D
customer33E M
)33M N
{44 	
if55 
(55 

ModelState55 
.55 
IsValid55 "
)55" #
{66 

repository77 
.77 
Add77 
(77 
customer77 '
)77' (
;77( )
return88 
RedirectToAction88 '
(88' (
nameof88( .
(88. /
Index88/ 4
)884 5
)885 6
;886 7
}99 
return:: 
View:: 
(:: 
customer::  
)::  !
;::! "
};; 	
public>> 
IActionResult>> 
Edit>> !
(>>! "
int>>" %
?>>% &
id>>' )
)>>) *
{?? 	
if@@ 
(@@ 
id@@ 
==@@ 
null@@ 
)@@ 
{AA 
returnBB 
NotFoundBB 
(BB  
)BB  !
;BB! "
}CC 
CustomerEE 
customerEE 
=EE 

repositoryEE  *
.EE* +
GetEE+ .
(EE. /
idEE/ 1
.EE1 2
ValueEE2 7
)EE7 8
;EE8 9
ifFF 
(FF 
customerFF 
==FF 
nullFF  
)FF  !
{GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
}II 
returnJJ 
ViewJJ 
(JJ 
customerJJ  
)JJ  !
;JJ! "
}KK 	
[PP 	
HttpPostPP	 
]PP 
[QQ 	$
ValidateAntiForgeryTokenQQ	 !
]QQ! "
publicRR 
IActionResultRR 
EditRR !
(RR! "
intRR" %
idRR& (
,RR( )
[RR* +
BindRR+ /
(RR/ 0
$strRR0 ?
)RR? @
]RR@ A
CustomerRRB J
customerRRK S
)RRS T
{SS 	
ifTT 
(TT 
idTT 
!=TT 
customerTT 
.TT 
IdTT !
)TT! "
{UU 
returnVV 
NotFoundVV 
(VV  
)VV  !
;VV! "
}WW 
ifYY 
(YY 

ModelStateYY 
.YY 
IsValidYY "
)YY" #
{ZZ 
try[[ 
{\\ 

repository]] 
.]] 
Edit]] #
(]]# $
customer]]$ ,
)]], -
;]]- .
}^^ 
catch__ 
(__ (
DbUpdateConcurrencyException__ 3
)__3 4
{`` 
ifaa 
(aa 

repositoryaa "
.aa" #
Getaa# &
(aa& '
customeraa' /
.aa/ 0
Idaa0 2
)aa2 3
==aa4 6
nullaa7 ;
)aa; <
{bb 
returncc 
NotFoundcc '
(cc' (
)cc( )
;cc) *
}dd 
elseee 
{ff 
throwgg 
;gg 
}hh 
}ii 
returnjj 
RedirectToActionjj '
(jj' (
nameofjj( .
(jj. /
Indexjj/ 4
)jj4 5
)jj5 6
;jj6 7
}kk 
returnll 
Viewll 
(ll 
customerll  
)ll  !
;ll! "
}mm 	
publicpp 
IActionResultpp 
Deletepp #
(pp# $
intpp$ '
?pp' (
idpp) +
)pp+ ,
{qq 	
ifrr 
(rr 
idrr 
==rr 
nullrr 
)rr 
{ss 
returntt 
NotFoundtt 
(tt  
)tt  !
;tt! "
}uu 
Customerww 
customerww 
=ww 

repositoryww  *
.ww* +
Getww+ .
(ww. /
idww/ 1
.ww1 2
Valueww2 7
)ww7 8
;ww8 9
ifxx 
(xx 
customerxx 
==xx 
nullxx  
)xx  !
{yy 
returnzz 
NotFoundzz 
(zz  
)zz  !
;zz! "
}{{ 
return}} 
View}} 
(}} 
customer}}  
)}}  !
;}}! "
}~~ 	
[
ÅÅ 	
HttpPost
ÅÅ	 
,
ÅÅ 

ActionName
ÅÅ 
(
ÅÅ 
$str
ÅÅ &
)
ÅÅ& '
]
ÅÅ' (
[
ÇÇ 	&
ValidateAntiForgeryToken
ÇÇ	 !
]
ÇÇ! "
public
ÉÉ 
IActionResult
ÉÉ 
DeleteConfirmed
ÉÉ ,
(
ÉÉ, -
int
ÉÉ- 0
id
ÉÉ1 3
)
ÉÉ3 4
{
ÑÑ 	

repository
ÖÖ 
.
ÖÖ 
Remove
ÖÖ 
(
ÖÖ 
id
ÖÖ  
)
ÖÖ  !
;
ÖÖ! "
return
ÜÜ 
RedirectToAction
ÜÜ #
(
ÜÜ# $
nameof
ÜÜ$ *
(
ÜÜ* +
Index
ÜÜ+ 0
)
ÜÜ0 1
)
ÜÜ1 2
;
ÜÜ2 3
}
áá 	
}
ââ 
}ää π;
r/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Controllers/RoomsController.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Controllers &
{ 
public 

class 
RoomsController  
:! "

Controller# -
{		 
private

 
IRepository

 
<

 
Room

  
>

  !

repository

" ,
;

, -
public 
RoomsController 
( 
IRepository *
<* +
Room+ /
>/ 0
repos1 6
)6 7
{ 	

repository 
= 
repos 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 

repository "
." #
GetAll# )
() *
)* +
.+ ,
ToList, 2
(2 3
)3 4
)4 5
;5 6
} 	
public 
IActionResult 
Details $
($ %
int% (
?( )
id* ,
), -
{ 	
if 
( 
id 
== 
null 
) 
{ 
return 
NotFound 
(  
)  !
;! "
} 
Room 
room 
= 

repository "
." #
Get# &
(& '
id' )
.) *
Value* /
)/ 0
;0 1
if   
(   
room   
==   
null   
)   
{!! 
return"" 
NotFound"" 
(""  
)""  !
;""! "
}## 
return%% 
View%% 
(%% 
room%% 
)%% 
;%% 
}&& 	
public)) 
IActionResult)) 
Create)) #
())# $
)))$ %
{** 	
return++ 
View++ 
(++ 
)++ 
;++ 
},, 	
[11 	
HttpPost11	 
]11 
[22 	$
ValidateAntiForgeryToken22	 !
]22! "
public33 
IActionResult33 
Create33 #
(33# $
[33$ %
Bind33% )
(33) *
$str33* :
)33: ;
]33; <
Room33= A
room33B F
)33F G
{44 	
if55 
(55 

ModelState55 
.55 
IsValid55 "
)55" #
{66 

repository77 
.77 
Add77 
(77 
room77 #
)77# $
;77$ %
return88 
RedirectToAction88 '
(88' (
nameof88( .
(88. /
Index88/ 4
)884 5
)885 6
;886 7
}99 
return:: 
View:: 
(:: 
room:: 
):: 
;:: 
};; 	
public>> 
IActionResult>> 
Edit>> !
(>>! "
int>>" %
?>>% &
id>>' )
)>>) *
{?? 	
if@@ 
(@@ 
id@@ 
==@@ 
null@@ 
)@@ 
{AA 
returnBB 
NotFoundBB 
(BB  
)BB  !
;BB! "
}CC 
RoomEE 
roomEE 
=EE 

repositoryEE "
.EE" #
GetEE# &
(EE& '
idEE' )
.EE) *
ValueEE* /
)EE/ 0
;EE0 1
ifFF 
(FF 
roomFF 
==FF 
nullFF 
)FF 
{GG 
returnHH 
NotFoundHH 
(HH  
)HH  !
;HH! "
}II 
returnJJ 
ViewJJ 
(JJ 
roomJJ 
)JJ 
;JJ 
}KK 	
[PP 	
HttpPostPP	 
]PP 
[QQ 	$
ValidateAntiForgeryTokenQQ	 !
]QQ! "
publicRR 
IActionResultRR 
EditRR !
(RR! "
intRR" %
idRR& (
,RR( )
[RR* +
BindRR+ /
(RR/ 0
$strRR0 @
)RR@ A
]RRA B
RoomRRC G
roomRRH L
)RRL M
{SS 	
ifTT 
(TT 
idTT 
!=TT 
roomTT 
.TT 
IdTT 
)TT 
{UU 
returnVV 
NotFoundVV 
(VV  
)VV  !
;VV! "
}WW 
ifYY 
(YY 

ModelStateYY 
.YY 
IsValidYY "
)YY" #
{ZZ 
try[[ 
{\\ 

repository]] 
.]] 
Edit]] #
(]]# $
room]]$ (
)]]( )
;]]) *
}^^ 
catch__ 
(__ (
DbUpdateConcurrencyException__ 3
)__3 4
{`` 
ifaa 
(aa 

repositoryaa "
.aa" #
Getaa# &
(aa& '
roomaa' +
.aa+ ,
Idaa, .
)aa. /
==aa0 2
nullaa3 7
)aa7 8
{bb 
returncc 
NotFoundcc '
(cc' (
)cc( )
;cc) *
}dd 
elseee 
{ff 
throwgg 
;gg 
}hh 
}ii 
returnjj 
RedirectToActionjj '
(jj' (
nameofjj( .
(jj. /
Indexjj/ 4
)jj4 5
)jj5 6
;jj6 7
}kk 
returnll 
Viewll 
(ll 
roomll 
)ll 
;ll 
}mm 	
publicpp 
IActionResultpp 
Deletepp #
(pp# $
intpp$ '
?pp' (
idpp) +
)pp+ ,
{qq 	
ifrr 
(rr 
idrr 
==rr 
nullrr 
)rr 
{ss 
returntt 
NotFoundtt 
(tt  
)tt  !
;tt! "
}uu 
Roomww 
roomww 
=ww 

repositoryww "
.ww" #
Getww# &
(ww& '
idww' )
.ww) *
Valueww* /
)ww/ 0
;ww0 1
ifxx 
(xx 
roomxx 
==xx 
nullxx 
)xx 
{yy 
returnzz 
NotFoundzz 
(zz  
)zz  !
;zz! "
}{{ 
return}} 
View}} 
(}} 
room}} 
)}} 
;}} 
}~~ 	
[
ÅÅ 	
HttpPost
ÅÅ	 
,
ÅÅ 

ActionName
ÅÅ 
(
ÅÅ 
$str
ÅÅ &
)
ÅÅ& '
]
ÅÅ' (
[
ÇÇ 	&
ValidateAntiForgeryToken
ÇÇ	 !
]
ÇÇ! "
public
ÉÉ 
IActionResult
ÉÉ 
DeleteConfirmed
ÉÉ ,
(
ÉÉ, -
int
ÉÉ- 0
id
ÉÉ1 3
)
ÉÉ3 4
{
ÑÑ 	
if
ÖÖ 
(
ÖÖ 
id
ÖÖ 
>
ÖÖ 
$num
ÖÖ 
)
ÖÖ 

repository
ÜÜ 
.
ÜÜ 
Remove
ÜÜ !
(
ÜÜ! "
id
ÜÜ" $
)
ÜÜ$ %
;
ÜÜ% &
return
áá 
RedirectToAction
áá #
(
áá# $
nameof
áá$ *
(
áá* +
Index
áá+ 0
)
áá0 1
)
áá1 2
;
áá2 3
}
àà 	
}
ää 
}ãã ı/
n/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Models/BookingViewModel.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Models !
{ 
public 

class 
BookingViewModel !
:" #
IBookingViewModel$ 5
{		 
private

 
IRepository

 
<

 
Booking

 #
>

# $
bookingRepository

% 6
;

6 7
private 
IBookingManager 
bookingManager  .
;. /
private 
int 
yearToDisplay !
;! "
public 
BookingViewModel 
(  
IRepository  +
<+ ,
Booking, 3
>3 4

repository5 ?
,? @
IBookingManagerA P
managerQ X
)X Y
{ 	
bookingRepository 
= 

repository  *
;* +
bookingManager 
= 
manager $
;$ %
} 	
public 
IEnumerable 
< 
Booking "
>" #
Bookings$ ,
{ 	
get 
{ 
return 
bookingRepository (
.( )
GetAll) /
(/ 0
)0 1
;1 2
} 
} 	
public 
int 
YearToDisplay  
{ 	
get 
{ 
int   
minBookingYear   "
=  # $
MinBookingDate  % 3
.  3 4
Year  4 8
;  8 9
int!! 
maxBookingYear!! "
=!!# $
MaxBookingDate!!% 3
.!!3 4
Year!!4 8
;!!8 9
if"" 
("" 
yearToDisplay"" !
<""" #
minBookingYear""$ 2
)""2 3
return## 
minBookingYear## )
;##) *
else$$ 
if$$ 
($$ 
yearToDisplay$$ &
>$$' (
maxBookingYear$$) 7
)$$7 8
return%% 
maxBookingYear%% )
;%%) *
else&& 
return'' 
yearToDisplay'' (
;''( )
}(( 
set)) 
{)) 
yearToDisplay)) 
=))  !
value))" '
;))' (
}))) *
}** 	
public,, 
string,, 
GetMonthName,, "
(,," #
int,,# &
month,,' ,
),,, -
{-- 	
return.. 
System.. 
... 
Globalization.. '
...' (
CultureInfo..( 3
...3 4
CurrentCulture..4 B
...B C
DateTimeFormat..C Q
...Q R#
GetAbbreviatedMonthName..R i
(..i j
month..j o
)..o p
;..p q
}// 	
public11 
bool11 
DateIsOccupied11 "
(11" #
int11# &
year11' +
,11+ ,
int11- 0
month111 6
,116 7
int118 ;
day11< ?
)11? @
{22 	
bool33 
occupied33 
=33 
false33 !
;33! "
if44 
(44 
day44 
<=44 
DateTime44 
.44  
DaysInMonth44  +
(44+ ,
year44, 0
,440 1
month442 7
)447 8
)448 9
{55 
DateTime66 
dt66 
=66 
new66 !
DateTime66" *
(66* +
year66+ /
,66/ 0
month661 6
,666 7
day668 ;
)66; <
;66< =
DateTime77 
occupiedDate77 %
=77& '
FullyOccupiedDates77( :
.77: ;
FirstOrDefault77; I
(77I J
d77J K
=>77L N
d77O P
==77Q S
dt77T V
)77V W
;77W X
if88 
(88 
occupiedDate88  
>88! "
DateTime88# +
.88+ ,
MinValue88, 4
)884 5
occupied99 
=99 
true99 #
;99# $
}:: 
return;; 
occupied;; 
;;; 
}<< 	
public>> 
List>> 
<>> 
DateTime>> 
>>> 
FullyOccupiedDates>> 0
{?? 	
get@@ 
{AA 
returnBB 
bookingManagerBB %
.BB% &!
GetFullyOccupiedDatesBB& ;
(BB; <
MinBookingDateBB< J
,BBJ K
MaxBookingDateBBL Z
)BBZ [
;BB[ \
}CC 
}DD 	
privateFF 
DateTimeFF 
MinBookingDateFF '
{GG 	
getHH 
{II 
varJJ 
bookingStartDatesJJ %
=JJ& '
BookingsJJ( 0
.JJ0 1
SelectJJ1 7
(JJ7 8
bJJ8 9
=>JJ: <
bJJ= >
.JJ> ?
	StartDateJJ? H
)JJH I
;JJI J
returnKK 
bookingStartDatesKK (
.KK( )
AnyKK) ,
(KK, -
)KK- .
?KK/ 0
bookingStartDatesKK1 B
.KKB C
MinKKC F
(KKF G
)KKG H
:KKI J
DateTimeKKK S
.KKS T
MinValueKKT \
;KK\ ]
}LL 
}MM 	
privateOO 
DateTimeOO 
MaxBookingDateOO '
{PP 	
getQQ 
{RR 
varSS 
bookingEndDatesSS #
=SS$ %
BookingsSS& .
.SS. /
SelectSS/ 5
(SS5 6
bSS6 7
=>SS8 :
bSS; <
.SS< =
EndDateSS= D
)SSD E
;SSE F
returnTT 
bookingEndDatesTT &
.TT& '
AnyTT' *
(TT* +
)TT+ ,
?TT- .
bookingEndDatesTT/ >
.TT> ?
MaxTT? B
(TTB C
)TTC D
:TTE F
DateTimeTTG O
.TTO P
MaxValueTTP X
;TTX Y
}UU 
}VV 	
}XX 
}YY ⁄
l/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Models/ErrorViewModel.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Models !
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
	RequestId 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
bool		 
ShowRequestId		 !
=>		" $
!		% &
string		& ,
.		, -
IsNullOrEmpty		- :
(		: ;
	RequestId		; D
)		D E
;		E F
}

 
} î	
o/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Models/IBookingViewModel.cs
	namespace 	
HotelBooking
 
. 
Mvc 
. 
Models !
{ 
public 

	interface 
IBookingViewModel &
{ 
IEnumerable		 
<		 
Booking		 
>		 
Bookings		 %
{		& '
get		( +
;		+ ,
}		- .
List

 
<

 
DateTime

 
>

 
FullyOccupiedDates

 )
{

* +
get

, /
;

/ 0
}

1 2
int 
YearToDisplay 
{ 
get 
;  
set! $
;$ %
}& '
string 
GetMonthName 
( 
int 
month  %
)% &
;& '
bool 
DateIsOccupied 
( 
int 
year  $
,$ %
int& )
month* /
,/ 0
int1 4
day5 8
)8 9
;9 :
} 
} Ã%
^/Users/hk/Documents/Undervisning/Test/Solutions/HotelBooking_Clean/HotelBooking.Mvc/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder		 
.		 
Services		 
.		 
AddDbContext		 
<		 
HotelBookingContext		 1
>		1 2
(		2 3
opt		3 6
=>		7 9
opt		: =
.		= >
UseInMemoryDatabase		> Q
(		Q R
$str		R b
)		b c
)		c d
;		d e
builder 
. 
Services 
. 
	AddScoped 
< 
IRepository &
<& '
Room' +
>+ ,
,, -
RoomRepository. <
>< =
(= >
)> ?
;? @
builder 
. 
Services 
. 
	AddScoped 
< 
IRepository &
<& '
Customer' /
>/ 0
,0 1
CustomerRepository2 D
>D E
(E F
)F G
;G H
builder 
. 
Services 
. 
	AddScoped 
< 
IRepository &
<& '
Booking' .
>. /
,/ 0
BookingRepository1 B
>B C
(C D
)D E
;E F
builder 
. 
Services 
. 
	AddScoped 
< 
IBookingManager *
,* +
BookingManager, :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
	AddScoped 
< 
IBookingViewModel ,
,, -
BookingViewModel. >
>> ?
(? @
)@ A
;A B
builder 
. 
Services 
. 
AddTransient 
< 
IDbInitializer ,
,, -
DbInitializer. ;
>; <
(< =
)= >
;> ?
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app 
. %
UseDeveloperExceptionPage !
(! "
)" #
;# $
using 	
(
 
var 
scope 
= 
app 
. 
Services #
.# $
CreateScope$ /
(/ 0
)0 1
)1 2
{ 
var 
services 
= 
scope 
. 
ServiceProvider ,
;, -
var   
	dbContext   
=   
services    
.    !

GetService  ! +
<  + ,
HotelBookingContext  , ?
>  ? @
(  @ A
)  A B
;  B C
var!! 
dbInitializer!! 
=!! 
services!! $
.!!$ %

GetService!!% /
<!!/ 0
IDbInitializer!!0 >
>!!> ?
(!!? @
)!!@ A
;!!A B
dbInitializer"" 
."" 

Initialize""  
(""  !
	dbContext""! *
)""* +
;""+ ,
}## 
}$$ 
else%% 
{&& 
app'' 
.'' 
UseExceptionHandler'' 
('' 
$str'' )
)'') *
;''* +
app)) 
.)) 
UseHsts)) 
()) 
))) 
;)) 
}** 
app,, 
.,, 
UseHttpsRedirection,, 
(,, 
),, 
;,, 
app.. 
... 
UseStaticFiles.. 
(.. 
).. 
;.. 
app00 
.00 

UseRouting00 
(00 
)00 
;00 
app22 
.22 
UseAuthorization22 
(22 
)22 
;22 
app44 
.44 
MapControllerRoute44 
(44 
name55 
:55 	
$str55
 
,55 
pattern66 
:66 
$str66 5
)665 6
;666 7
app88 
.88 
Run88 
(88 
)88 	
;88	 
